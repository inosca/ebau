<div {{did-insert this.setElement}}>
  <div class="uk-flex uk-flex-between">
    <div class="uk-button-group">
      <UkButton
        @color={{if this.showOnlyUnread "default" "primary"}}
        data-test-show-all
        {{on "click" (fn this.updateFilter false)}}
      >
        {{t "communications.topics.all"}}
      </UkButton>
      <UkButton
        @color={{if this.showOnlyUnread "primary" "default"}}
        data-test-show-unread
        {{on "click" (fn this.updateFilter true)}}
      >
        {{t "communications.topics.unread"}}
      </UkButton>
    </div>
    {{#if (and @instance @newRoute)}}
      <LinkTo @route={{@newRoute}} data-test-new-topic>
        <UkButton @color="primary">
          {{t "communications.topics.newMessage"}}
        </UkButton>
      </LinkTo>
    {{/if}}
  </div>

  <table class="uk-table uk-table-striped">
    <thead>
      <tr>
        {{#unless @instance}}
          <th data-test-instance-header>{{t "communications.dossier"}}</th>
        {{/unless}}
        <th>{{t "communications.topic"}}</th>
        <th>{{t "communications.participants"}}</th>
        <th>{{t "communications.date"}}</th>
      </tr>
    </thead>
    <tbody>
      {{#unless this.topicsListHidden}}
        {{#each this.topics.records as |topic|}}
          <tr
            class="{{if topic.hasUnread 'uk-text-bold'}}"
            data-test-topic
            role="link"
            {{on "click" (fn this.transitionToTopic topic.instance.id)}}
          >
            {{#unless @instance}}
              <td data-test-dossier-number>
                {{topic.instance.dossierNumber}}
                ({{topic.instance.id}})
              </td>
            {{/unless}}
            <td data-test-subject>{{topic.subject}}</td>
            <td data-test-involved-entities>
              {{#each topic.involvedEntities as |entity|}}
                {{entity.service.name}}<br />
              {{else}}
                -
              {{/each}}
            </td>
            <td>{{format-date
                topic.created
                day="2-digit"
                month="2-digit"
                year="numeric"
                hour="numeric"
                minute="numeric"
              }}</td>
          </tr>
        {{else}}
          {{#unless this.topics.isLoading}}
            <tr>
              <td>{{t "communications.empty"}}</td>
            </tr>
          {{/unless}}
        {{/each}}
      {{/unless}}
      {{#if this.topics.isLoading}}
        <tr>
          <td colspan="4" class="uk-text-center">{{t
              "communications.loading"
            }}</td>
        </tr>
      {{else if this.topics.hasMore}}
        <tr {{in-viewport onEnter=this.updatePage}}>
          <td colspan="4" class="uk-text-center">{{t
              "communications.loading"
            }}</td>
        </tr>
      {{else if this.topics.records.length}}
        <tr>
          <td colspan="4" class="uk-text-center">
            {{t "communications.noMoreData"}}

            <button
              type="button"
              class="uk-margin-small-left uk-icon-button"
              uk-icon="chevron-up"
              uk-tooltip={{t "communications.backToFirst"}}
              data-test-back-to-first
              {{on "click" this.scrollToFirst}}
            ></button>
          </td>
        </tr>
      {{/if}}
    </tbody>
  </table>
</div>
