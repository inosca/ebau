<h1 class="uk-flex uk-flex-between">
  {{t "instances.title"}}

  {{#if (can "create instance")}}
    <span>
      <LinkTo @route="instances.new" class="uk-button uk-button-secondary">{{t "instances.new.title"}}</LinkTo>
    </span>
  {{/if}}
</h1>

<form {{on "submit" (perform this.applyFilters)}}>
  <div uk-grid class="uk-grid-small uk-margin uk-child-width-1-1 uk-child-width-1-3@l">
    <div>
      <label class="uk-form-label" for="type">{{t "instances.type"}}</label>
      <div class="uk-form-controls">
        <PowerSelectMultiple
          @selected={{this.selectedTypes}}
          @options={{this.formFilterOptions}}
          @searchField="name"
          @onChange={{fn (mut this.selectedTypes)}}
        as |form|>
          {{form.name}}
        </PowerSelectMultiple>
      </div>
    </div>
    <div>
      <label class="uk-form-label" for="instanceId">{{t (concat "instances.instance-id-" (application-name))}}</label>
      <div class="uk-form-controls">
        <input
          type="number"
          step="1"
          class="uk-input"
          name="instanceId"
          id="instanceId"
          value={{this.instanceId}}
          {{on "change" this.updateFilter}}
        >
      </div>
    </div>
    <div>
      <label class="uk-form-label" for="specialId">{{t (concat "instances.special-id-" (application-name))}}</label>
      <div class="uk-form-controls">
        <input
          type="text"
          class="uk-input"
          name="specialId"
          id="specialId"
          value={{this.specialId}}
          {{on "change" this.updateFilter}}
        >
      </div>
    </div>
    <div>
      <label class="uk-form-label" for="parcel">{{t "instances.parcel"}}</label>
      <div class="uk-form-controls">
        <input
          type="text"
          class="uk-input"
          name="parcel"
          id="parcel"
          value={{this.parcel}}
          {{on "change" this.updateFilter}}
        >
      </div>
    </div>
    <div>
      <label class="uk-form-label" for="address">{{t (concat "instances.address-" (application-name))}}</label>
      <div class="uk-form-controls">
        <input
          type="text"
          class="uk-input"
          name="address"
          id="address"
          value={{this.address}}
          {{on "change" this.updateFilter}}
        >
      </div>
    </div>
    <div>
      <label class="uk-form-label">{{t "instances.submitDate"}}</label>
      <div class="uk-form-controls uk-grid-small uk-child-width-1-2" uk-grid>
        <div>
          <PikadayInput
            class="uk-input"
            aria-label={{t "instances.submitDateFrom"}}
            @name="submitFrom"
            @useUTC={{true}}
            @value={{this.submitFrom}}
            @onSelection={{fn this.updateDate "submitFrom"}}
          />
        </div>
        <div>
          <PikadayInput
            class="uk-input"
            @name="submitTo"
            @useUTC={{true}}
            aria-label={{t "instances.submitDateTo"}}
            @value={{this.submitTo}}
            @onSelection={{fn this.updateDate "submitTo"}}
          />
        </div>
      </div>
    </div>
    <div class="uk-button-group uk-width-1-2 uk-flex uk-flex-left uk-flex-bottom">
      {{#each this.categories as |c|}}
        <UkButton
          @label={{t (concat "instances.categories." c)}}
          @color={{if (eq c this.category) "primary" "default"}}
          @on-click={{fn this.updateCategory c}}
        />
      {{/each}}
    </div>
    <div class="uk-width-1-2 uk-flex uk-flex-right uk-flex-bottom">
      <UkButton
        class="uk-margin-small-right"
        @color="default"
        @type="reset"
        @disabled={{this.cases.isLoading}}
        @label={{t "instances.reset"}}
        @on-click={{perform this.resetFilters}}
       />
      <UkButton
        @color="primary"
        @type="submit"
        @disabled={{this.cases.isLoading}}
        @label={{t "instances.filter"}}
       />
    </div>
  </div>
</form>

<hr>

{{#if (and this.cases.isLoading (eq this.cases.value.length 0))}}
  <div class="uk-text-center uk-padding">
    <UkSpinner @ratio={{2}} />
  </div>
{{else if this.cases.value.length}}
  <div uk-grid>
    <div class="uk-width-expand uk-flex uk-flex-middle uk-text-meta">
      <span>{{t "instances.pageInfo" length=this.cases.value.length total=this.cases.totalCount htmlSafe=true}}</span>
    </div>

    <div class="uk-width-auto uk-flex uk-flex-middle">
      <label class="uk-text-meta uk-text-nowrap" for="order">
        {{t "instances.orderBy"}}:
      </label>
      <select class="uk-select uk-form-small uk-margin-small-left" name="order" id="order" {{on "change" this.updateOrder}}>
        {{#each this.orderOptions as |o|}}
          <option value={{o.value}} selected={{eq this.order o.value}}>{{t o.label}} ({{t o.direction}})</option>
        {{/each}}
      </select>
    </div>
  </div>
  <table class="uk-table uk-table-striped uk-table-hover uk-table-responsive">
    <thead>
      <tr>
        <th class="uk-text-nowrap">{{t (concat "instances.instance-id-" (application-name))}}</th>
        <th class="uk-text-nowrap">{{t (concat "instances.special-id-" (application-name))}}</th>
        <th class="uk-text-nowrap">{{t "instances.type"}}</th>
        <th class="uk-text-nowrap">{{t "instances.municipality"}}</th>
        <th class="uk-text-nowrap">{{t (concat "instances.address-" (application-name))}}</th>
        <th class="uk-text-nowrap">{{t "instances.submitDate"}}</th>
        <th class="uk-text-nowrap">{{t "instances.status.title"}}</th>
        <th class="uk-text-nowrap">{{t (concat "instances.description-" (application-name))}}</th>
      </tr>
    </thead>
    <tbody>
      {{#each this.cases.value as |case|}}
        <tr class="uk-table-middle">
          <td>
            <LinkTo @route="instances.edit" @model={{case.instanceId}} class="uk-text-bold">{{case.instanceId}}</LinkTo>
          </td>
          <td class="uk-text-nowrap">{{case.specialId}}</td>
          <td class="uk-text-nowrap">{{case.type}} {{case.instance.typeDetail}}</td>
          <td>{{case.municipality}}</td>
          <td class="uk-text-truncate" title={{case.address}}>{{case.address}}</td>
          <td>{{if case.submitDate (moment-format case.submitDate "DD.MM.YYYY")}}</td>
          <td>{{case.status}}</td>
          <td class="uk-text-truncate" title={{case.description}}>{{case.description}}</td>
        </tr>
      {{/each}}
      {{#if this.cases.hasNextPage}}
        <tr>
          <td
            colspan="8"
            class="uk-text-center"
            {{in-viewport onEnter=(perform this.getMoreCases) viewportSpy=true}}
          >
            <UkSpinner />
          </td>
        </tr>
      {{/if}}
    </tbody>
  </table>
{{else}}
  <UkFlex @horizontal="center" @vertical="middle" @direction="column">
    <div class="uk-text-center uk-width-large">
      <object data="/assets/images/stamp-document.svg" class="uk-width-medium">{{t "instances.new.title"}}</object>
      <p class="uk-margin-remove-top uk-text-large">{{t "instances.emptyTitle"}}</p>
      <p>{{t "instances.emptyText"}}</p>
      <LinkTo @route="instances.new" class="uk-button uk-button-primary uk-button-large">{{t "instances.new.title"}}</LinkTo>
    </div>
  </UkFlex>
{{/if}}
