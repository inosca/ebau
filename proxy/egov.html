<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>eGov Demo</title>
  </head>
  <body>
    <strong>Login als natürliche Person (LoT 1)</strong>
    <br />
    <a href="/prestation/1?redirectUrl=http://localhost:4200/login">eBauSO</a>
    <br />
    <a href="/prestation/2?redirectUrl=http://localhost:4200/login">
      eBauSO - öffentliche Planauflage
    </a>
    <br />
    <br />
    <strong>Login als Firma</strong>
    <br />
    <a href="/prestation/3?redirectUrl=http://localhost:4200/login">eBauSO </a>
    <br />
    <a href="/prestation/4?redirectUrl=http://localhost:4200/login">
      eBauSO - öffentliche Planauflage
    </a>
    <br />
    <br />
    <strong>Login als natürliche Person (LoT 0 - nur Planauflage)</strong>
    <br />
    <a href="/prestation/5?redirectUrl=http://localhost:4200/login">eBauSO</a>
    <br />
    <a href="/prestation/6?redirectUrl=http://localhost:4200/login">
      eBauSO - öffentliche Planauflage
    </a>

    <script>
      // The token that we return here is an encrypted and signed token
      // consisting of test data and an expiry in the year 3000. The token is
      // encrypted and signed with the default secrets found in the django
      // settings.
      //
      // To take a look at the content of the tokens, decrypt the token using
      // https://dinochiesa.github.io/jwt/ and decode it afterwards using
      // https://jwt.io/.
      //
      // To modify the token, change the data in the
      // `django/camac/token_exchange/management/commands/generate_dev_tokens.py`
      // file, run the command and copy the new tokens from the output file into
      // the variables below.
      const userToken =
        "eyJhbGciOiJkaXIiLCJjdHkiOiJKV1QiLCJlbmMiOiJBMjU2Q0JDLUhTNTEyIiwidHlwIjoiSldUIn0..Vw9SGvNEGQX4YGs7LlZVvA.L-8_TeAgsn5_AZGQrc8eEB8cs9H2lJ7TX0bzHl_2CFkVGSlnwFlJ-zNR5Z3b2PkNLgvVeyvHHsUjM0FSauQ49-fM2A032TEdW1utyfRo9eF2ifZRqzkV2hNP4xKVwp-Mgdwb4Ot1xw_PeaTKvn5yNSZn-zCueUcjQgWGsc35S1GeKvRVh-qkAxiIKsdI1E0Mt31AKmOGEeUnCLzU_lgEw-ugblE2lUCp_01YZB53W4XRliWg7yLAjDVl7JAGn6SNHEjsWvFJ3eVBhHKYwKpw8iojZ9WCpCxLyVqsoV0UK_ZLu6U4u7XhW_VLOml1zeGJDP2E1eHVrIz84poR8shN1V08W6tmskHRqqvzYQolFS3jVpm_DCaW3f43PHgeYErf5TMg0_LquKWCPyJZMggX1PT07fGd9N2WyzXyt8oOY9LoHrCCNrRecyqNCGUVyN44.BxyLDws4SbInRH6KoHSfJ60RkdOLM3sNKfZMsahDf00";
      const companyToken =
        "eyJhbGciOiJkaXIiLCJjdHkiOiJKV1QiLCJlbmMiOiJBMjU2Q0JDLUhTNTEyIiwidHlwIjoiSldUIn0.._pdxqC5tEQeAr5u-9R-p9A.L38T-Vnin30ERU33HavLcTWnTZccpCACoApOuHy9Go6UN-eBBN6iMp7_8oprMjx5NCyfU6NxN1ar0jQit37e7WzTq6ZqJ4vBTf11fgFFfmeXsH2ZWgaWDWW0awRnDZhaxCv3DKozFjK4dxE5_4LAZv0JLx_VTKVN71yJJxdcVlWC9MxhrXC3nQC0mc500VMC328kzPVZKpbjWOHffonqbuLJMRVxkpHu-WFx2AX2zoyVzOuYvXKxpujJa6gyBzfeC5OI0DkGoSKuZylYEuio3pIayX9ISZLs-fKsiZoijMksBMC2hJ6HFXeR0mjXC0GENimxPUwfD5Ie4nZNYnhT0tb0URSrI3HEtgF3CR3sYUmRm5_TiTnTI85wCfnHsYL6F-u6sSa30wHxSvYAaZNGvG9e3X8Pbojzy65igZnIpkEUczRH1LGbb9dXI-pynOlJqEM1Gg-ruHuqKu68yeHuaw.aWJecAitFxEfhIoN6RLVGvIILukpgRc1NgNozKQ4l5w";
      const userTokenLoT0 =
        "eyJhbGciOiJkaXIiLCJjdHkiOiJKV1QiLCJlbmMiOiJBMjU2Q0JDLUhTNTEyIiwidHlwIjoiSldUIn0..CEnX9cHxzGXBUwzaLrkWCg.vXLdk1trWKyk-CIrcgVIsqdZZB9sfjEa0r_fbRbO7jDmwCxEZn1YJ91hPQ7mIaPD-9UWcB1l2clc5V9GAf5Sg058m1rXU0VavmhSuWevMiLHnlQXRufCAso8mzEmcyd4wfdlVub8yf0Vz9zxM0Xzc8-8-VivFPEItDGN8ygQxPcGXTALe9RongvgmtJOtIIrBqUbzqwcd8k9zX6iY4OVcyvn7rtltd_nsKYvY6fvSt9fynQx7cFqDALd3LemUl5SemU_zyW_1x-S6Q_Tvl1PInCJ8GH2Q6RKvyCWIDu4MpKjHX9f-lupaiV1SD5zlEcDsbxlS6cqdNSgMNM1RHWaRmg7bka8oKuqkcuAVsxFvJx0yTCKCDSoCwL7nkmDdxAfO6EGxPCkdu7UeM8PUWGC8xYbD2Z-40Vk6Z1z_Auj6QS6IzzVWyfzY_o6q8i5Ik1r.p_LQlXBotmMEvI7ph097h44FL3MRedkOILd45WSXr2w";

      const mapping = {
        1: (url) => `${url}?token=${userToken}`,
        2: (url) => `${url}?nextURL=/public-instances&token=${userToken}`,
        3: (url) => `${url}?token=${companyToken}`,
        4: (url) => `${url}?nextURL=/public-instances&token=${companyToken}`,
        5: (url) => `${url}?token=${userTokenLoT0}`,
        6: (url) => `${url}?nextURL=/public-instances&token=${userTokenLoT0}`,
      };

      try {
        const prestationId = parseInt(
          location.pathname.match(/prestation\/(\d+)/)[1],
        );
        const redirectUrl = location.search.match(/redirectUrl=(.*)/)[1];
        const url = mapping[prestationId](redirectUrl);

        // This whole redirection logic was first implemented using NGINX only.
        // However, we can't do that anymore because the portal checks the
        // referer header on login which is not the right one if we simply do a
        // redirect from NGINX.
        location.assign(url);
      } catch {}
    </script>
  </body>
</html>
